// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  // output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Users {
  id               String           @id @default(uuid())
  name             String
  email            String           @unique
  role             Role             @default(candidate)
  password         String?
  createdAt        DateTime         @default(now())
  CandidateProfile UserProfile?     @relation("CandidateUserProfile")
  VendorProfiles   UserProfile[]    @relation("VendorUserProfiles")
  Job              Job[]            @relation("UserPostedJobs")
  JobApplications  JobApplication[]
  SavedJobs        SavedJob[]
 courses          Course[]         // NEW: One user can have many courses
}

enum Role {
  candidate
  company
  admin
}

enum JobType {
  FullTime
  Contract
  Freelance
}

model UserProfile {
  id       String  @id @default(uuid())
  userId   String? @unique
  vendorId String?
  user     Users?  @relation("CandidateUserProfile", fields: [userId], references: [id], onDelete: Cascade)
  vendor   Users?  @relation("VendorUserProfiles", fields: [vendorId], references: [id], onDelete: Cascade)

  // venderId                     String?
  profilePicture               String?
  title                        String?
  name                         String?
  phoneNumber                  String?
  email                        String?
  portfolioLink                String?
  preferredLocation            String[]
  currentLocation              String?
  preferredJobType             JobType[]
  currentCTC                   String?
  expectedCTC                  String?
  rateCardPerHour              Json?
  joiningPeriod                String?
  totalExperience              String?
  relevantSalesforceExperience String?

  skillsJson      Json? // e.g. [{ name: "Apex", experience: 3, level: "primary" }]
  primaryClouds   Json?
  secondaryClouds Json?

  certifications String[]
  workExperience Json?
  education      Json?

  address Address?

  linkedInUrl  String?
  trailheadUrl String?

  isVerified      Boolean   @default(false)
  verificationOtp String?
  otpExpiry       DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Skills {
  id         String  @id @default(uuid())
  name       String  @unique
  isVerified Boolean @default(false)
}

model Certification {
  id         String  @id @default(uuid())
  name       String  @unique
  isVerified Boolean @default(false)
}

model Location {
  id         String  @id @default(uuid())
  name       String  @unique
  isVerified Boolean @default(false)
}

model Cloud {
  id         String  @id @default(uuid())
  name       String  @unique
  isVerified Boolean @default(false)
}

enum EmploymentType {
  FullTime
  PartTime
  Internship
  Contract
  Freelance
}

enum ExperienceLevel {
  Internship
  EntryLevel
  Mid
  Senior
  Lead
}

enum JobStatus {
  Open
  Closed
  Draft
}

model Job {
  id                  String           @id @default(uuid())
  role                String
  description         String?
  employmentType      EmploymentType
  experience          String?
  experienceLevel     ExperienceLevel?
  location            String?
  skills              String[] // Array of Json Skills
  clouds              String[]
  salary              Int
  companyName         String?
  responsibilities    String[]
  qualifications      String[]
  jobType             String
  status              JobStatus        @default(Open)
  applicationDeadline String
  isDeleted           Boolean          @default(false)
  deletedReason       String?
  deletedAt           DateTime?

  postedById String?
  postedBy   Users?  @relation("UserPostedJobs", fields: [postedById], references: [id])

  applications JobApplication[]
  savedBy      SavedJob[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum ApplicationStatus {
  Pending
  Reviewed
  Shortlisted
  Rejected
  Hired
}

model JobApplication {
  id        String            @id @default(uuid())
  jobId     String
  userId    String
  status    ApplicationStatus @default(Pending)
  appliedAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt

  job  Job   @relation(fields: [jobId], references: [id], onDelete: Cascade)
  user Users @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([jobId, userId]) // Prevent duplicate applications
  @@index([userId])
  @@index([jobId])
}

model SavedJob {
  id      String   @id @default(uuid())
  jobId   String
  userId  String
  savedAt DateTime @default(now())

  job  Job   @relation(fields: [jobId], references: [id], onDelete: Cascade)
  user Users @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([jobId, userId]) // Prevent duplicate saves
  @@index([userId])
  @@index([jobId])
}

model Address {
  id         String      @id @default(uuid())
  doorNumber String?
  street     String?
  city       String?
  state      String?
  country    String?
  pinCode    String?
  profileId  String      @unique
  profile    UserProfile @relation(fields: [profileId], references: [id])
}

model Country {
  id     String  @id @default(uuid())
  name   String  @unique
  code   String?
  states State[]
}

model State {
  id        String  @id @default(uuid())
  name      String
  code      String?
  countryId String
  country   Country @relation(fields: [countryId], references: [id])
}
model Course {
  id          String   @id @default(uuid())
  title       String
  description String?
  price       Float    @default(0)
  createdAt   DateTime @default(now())

  // Relations
  instructor  Users    @relation(fields: [userId], references: [id])
  userId      String
  videos      Video[]

  @@index([userId])
}
model Video {
  id         String   @id @default(uuid())
  fileName   String
  url        String
  size       Int?
  duration   Int?
  metaData   Json?    // optional: store backend raw info if needed
  createdAt  DateTime @default(now())

  // Relations
  course     Course   @relation(fields: [courseId], references: [id])
  courseId   String

  @@index([courseId])
}
